{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport BigNumber from 'bignumber.js';\nimport { Denom } from '../../../../consts/denom';\nimport { times } from '../../../../libs/math';\nimport { SYMBOLS } from '../../../../consts/symbol';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../api/spectrum-astroport-generic-farm.service\";\nimport * as i2 from \"../../../terrajs.service\";\nimport * as i3 from \"../../../api/wasm.service\";\nexport let AstroportAstroLunaFarmInfoService = /*#__PURE__*/(() => {\n  class AstroportAstroLunaFarmInfoService {\n    constructor(farmService, terrajs, wasm) {\n      this.farmService = farmService;\n      this.terrajs = terrajs;\n      this.wasm = wasm;\n      this.farm = 'Astroport';\n      this.farmColor = '#463df6';\n      this.auditWarning = false;\n      this.farmType = 'LP';\n      this.dex = 'Astroport';\n      this.highlight = false;\n      this.notUseAstroportGqlApr = false;\n      this.availableNetworks = new Set(['testnet']);\n      this.poolType = 'xyk';\n      this.refreshContractOnNetwork();\n    }\n    refreshContractOnNetwork() {\n      this.baseTokenContract = this.terrajs.settings.astroToken;\n      this.denomTokenContract = Denom.LUNA;\n      this.poolAprs = [{\n        apr: 0,\n        rewardSymbol: SYMBOLS.ASTRO,\n        rewardContract: this.terrajs.settings.astroToken\n      }];\n      this.farmContract = this.terrajs.settings.astroportAstroLunaFarm;\n      this.compoundProxyContract = this.terrajs.settings.astroportAstroLunaFarmCompoundProxy;\n      this.contractOnNetwork = this.terrajs.networkName;\n    }\n    // no LP APR calculation, return 0 to use Astroport API\n    queryPairStats(poolInfos, poolResponses, govVaults, pairInfos, tokenInfos, ulunaPrice) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const key = `${this.dex}|${this.baseTokenContract}|${this.denomTokenContract}`;\n        const depositAmountTask = this.wasm.query(this.terrajs.settings.astroportGenerator, {\n          deposit: {\n            lp_token: pairInfos[key].liquidity_token,\n            user: this.farmContract\n          }\n        });\n        const pairs = {};\n        const [depositAmount] = yield Promise.all([depositAmountTask]);\n        const p = poolResponses[key];\n        const uluna = p.assets.find(a => {\n          var _a;\n          return ((_a = a.info['native_token']) === null || _a === void 0 ? void 0 : _a['denom']) === this.denomTokenContract;\n        });\n        if (!uluna) {\n          return;\n        }\n        pairs[key] = {\n          poolAprs: this.poolAprs,\n          poolApy: 0,\n          tvl: '0',\n          multiplier: 0,\n          vaultFee: 0\n        };\n        const pair = pairs[key];\n        const totalUlunaValueUSD = times(ulunaPrice, uluna.amount);\n        pair.tvl = new BigNumber(totalUlunaValueUSD).times(depositAmount).times(2).div(p.total_share).toString();\n        return pairs;\n      });\n    }\n    queryReward() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const rewardInfo = yield this.farmService.query(this.farmContract, {\n          reward_info: {\n            staker_addr: this.terrajs.address\n          }\n        });\n        return rewardInfo.reward_info;\n      });\n    }\n  }\n  AstroportAstroLunaFarmInfoService.ɵfac = function AstroportAstroLunaFarmInfoService_Factory(t) {\n    return new (t || AstroportAstroLunaFarmInfoService)(i0.ɵɵinject(i1.SpectrumAstroportGenericFarmService), i0.ɵɵinject(i2.TerrajsService), i0.ɵɵinject(i3.WasmService));\n  };\n  AstroportAstroLunaFarmInfoService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AstroportAstroLunaFarmInfoService,\n    factory: AstroportAstroLunaFarmInfoService.ɵfac\n  });\n  return AstroportAstroLunaFarmInfoService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}